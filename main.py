import pygame
import numpy as np
import math

pygame.init()

window = pygame.display.set_mode((1080, 720))
clock = pygame.time.Clock()
fps = 30
dt = 0
time = 0
fr = 20

path = []

data = [np.array([262.84441959, -34.26277061]), np.array([257.81867801, -42.89330955]),
        np.array([252.16763126, -51.13246055]), np.array([246.18548404, -59.13522239]),
        np.array([239.97866641, -66.96531577]), np.array([233.59885989, -74.65517326]),
        np.array([227.07252322, -82.22115989]), np.array([220.41329776, -89.67046256]),
        np.array([213.62589847, -97.00312705]), np.array([206.70716678, -104.21201225]),
        np.array([199.64602481, -111.28134818]), np.array([192.4195386, -118.18151756]),
        np.array([184.98486148, -124.85639854]), np.array([177.25588809, -131.18688102]),
        np.array([169.01586734, -136.82611747]), np.array([164.19373904, -143.08235069]),
        np.array([166.70136844, -152.7531919]), np.array([168.66078006, -162.54979225]),
        np.array([170.05938541, -172.44201942]), np.array([170.89008914, -182.39802451]),
        np.array([171.15151797, -192.38519187]), np.array([170.83799564, -202.37079139]),
        np.array([169.91459476, -212.31831642]), np.array([168.34039127, -222.18356986]),
        np.array([166.07876407, -231.91395469]), np.array([163.09931766, -241.44880576]),
        np.array([159.37916385, -250.71949287]), np.array([154.90411197, -259.64997001]),
        np.array([149.66720401, -268.15569969]), np.array([143.66322147, -276.13776489]),
        np.array([136.86726199, -283.45550628]), np.array([129.29754459, -285.77199645]),
        np.array([122.41717349, -278.53443809]), np.array([116.32562076, -270.61872573]),
        np.array([110.96964847, -262.18717094]), np.array([106.33927737, -253.33600707]),
        np.array([102.43061649, -244.14303108]), np.array([99.23679935, -234.67770286]),
        np.array([96.74409305, -225.00382896]), np.array([94.93198978, -215.17949958]),
        np.array([93.7726575, -205.25672813]), np.array([93.23322879, -195.28084464]),
        np.array([93.27886783, -185.29038139]), np.array([93.89781009, -175.31900688]),
        np.array([95.08653079, -165.39934821]), np.array([96.83788882, -155.56341453]),
        np.array([99.13892947, -145.84131522]), np.array([93.12235843, -141.25484367]),
        np.array([86.79336368, -143.4892797]), np.array([84.27781497, -153.15815254]),
        np.array([81.22668277, -162.67145439]), np.array([77.64285098, -171.99718757]),
        np.array([73.53414737, -181.10384651]), np.array([68.91219913, -189.9610128]),
        np.array([63.79321109, -198.54060264]), np.array([58.18617831, -206.8092794]),
        np.array([52.07997714, -214.71625419]), np.array([45.46453677, -222.20198341]),
        np.array([38.33761417, -229.20210548]), np.array([30.70644199, -235.64844795]),
        np.array([22.58946811, -241.47073264]), np.array([14.01576053, -246.59623237]),
        np.array([5.02583133, -250.94962211]), np.array([-4.33200253, -254.44123168]),
        np.array([-14.00415982, -256.9264936]), np.array([-20.80199612, -253.52384467]),
        np.array([-22.67523373, -243.71448417]), np.array([-23.54599179, -233.76416679]),
        np.array([-23.52875699, -223.77522559]), np.array([-22.67953671, -213.82217307]),
        np.array([-21.04197873, -203.96788307]), np.array([-18.65920438, -194.26654334]),
        np.array([-15.57660092, -184.76421638]), np.array([-11.84301175, -175.49800392]),
        np.array([-7.50963773, -166.49652763]), np.array([-2.62804593, -157.77989478]),
        np.array([2.75227939, -149.36176963]), np.array([8.60433017, -141.26441093]),
        np.array([14.90867435, -133.51410575]), np.array([21.64333926, -126.13472648]),
        np.array([28.78323947, -119.14641471]), np.array([36.30132114, -112.56679435]),
        np.array([44.17009555, -106.41060539]), np.array([51.80449496, -100.50968833]),
        np.array([48.86833011, -90.96364494]), np.array([42.94701968, -91.03070731]),
        np.array([34.61288272, -96.5404882]), np.array([25.99930392, -101.60264488]),
        np.array([17.13441287, -106.21035667]), np.array([8.04469119, -110.35707755]),
        np.array([-1.24333371, -114.03813835]), np.array([-10.70411862, -117.24944206]),
        np.array([-20.31250943, -119.98803611]), np.array([-30.04374112, -122.25149436]),
        np.array([-39.873392, -124.03951927]), np.array([-49.77779568, -125.35222526]),
        np.array([-59.7334689, -126.19114585]), np.array([-69.7178439, -126.5592794]),
        np.array([-79.70839871, -126.46060844]), np.array([-89.68348111, -125.89474387]),
        np.array([-99.62043179, -124.85738273]), np.array([-109.49643124, -123.3458242]),
        np.array([-119.28808774, -121.3596334]), np.array([-128.97096814, -118.89766593]),
        np.array([-138.52087964, -115.96207328]), np.array([-147.91265668, -112.55438896]),
        np.array([-157.12081326, -108.67774864]), np.array([-166.11943997, -104.33679862]),
        np.array([-174.88166608, -99.53689475]), np.array([-183.3801402, -94.28398795]),
        np.array([-191.5864581, -88.58579154]), np.array([-199.47203244, -82.4512548]),
        np.array([-207.00646771, -75.89021964]), np.array([-214.15901936, -68.91506858]),
        np.array([-220.89762105, -61.53923698]), np.array([-227.19026936, -53.77970786]),
        np.array([-233.0040511, -45.65508933]), np.array([-238.3057269, -37.18749137]),
        np.array([-243.06345929, -28.4028234]), np.array([-249.64994038, -26.26790519]),
        np.array([-259.4195155, -27.99186607]), np.array([-269.01221932, -25.49572654]),
        np.array([-276.76667012, -19.29991813]), np.array([-281.60191335, -10.62552543]),
        np.array([-282.7706498, -0.76898094]), np.array([-280.02641381, 8.77259926]),
        np.array([-273.89700688, 16.58607583]), np.array([-265.22861947, 21.40927987]),
        np.array([-259.08806027, 25.48026375]), np.array([-261.03216828, 35.27327065]),
        np.array([-261.96290482, 45.22143655]), np.array([-262.66506852, 55.18859963]),
        np.array([-263.17063988, 65.1676188]), np.array([-263.48184766, 75.15455727]),
        np.array([-263.58906163, 85.14579873]), np.array([-263.47910394, 95.13690285]),
        np.array([-263.12803925, 105.12255959]), np.array([-262.50781239, 115.09489541]),
        np.array([-261.58058919, 125.04324441]), np.array([-260.29654492, 134.95172219]),
        np.array([-258.58946408, 144.79579262]), np.array([-256.36977948, 154.53682046]),
        np.array([-253.515005, 164.10984902]), np.array([-249.85541333, 173.40322976]),
        np.array([-245.15960492, 182.2146769]), np.array([-239.14148892, 190.17308144]),
        np.array([-231.56655301, 196.65011697]), np.array([-222.54166783, 200.85714822]),
        np.array([-212.69656171, 202.37783913]), np.array([-202.7045535, 202.38923745]),
        np.array([-192.71257962, 202.38923745]), np.array([-182.72051419, 202.38923745]),
        np.array([-172.72854031, 202.38923745]), np.array([-162.73656644, 202.38923745]),
        np.array([-152.74450101, 202.38923745]), np.array([-142.75261868, 202.38923745]),
        np.array([-132.76055325, 202.38923745]), np.array([-122.76867093, 202.38923745]),
        np.array([-112.7766055, 202.38923745]), np.array([-102.78454007, 202.38923745]),
        np.array([-92.79265775, 202.38923745]), np.array([-82.80059232, 202.38923745]),
        np.array([-72.80870999, 202.38923745]), np.array([-62.81664456, 202.38923745]),
        np.array([-52.82457913, 202.38923745]), np.array([-42.83269681, 202.38923745]),
        np.array([-32.84063138, 202.38923745]), np.array([-27.50997342, 198.13006692]),
        np.array([-31.10959805, 188.87948708]), np.array([-37.75069608, 181.46728615]),
        np.array([-46.0560397, 175.94299416]), np.array([-55.1681918, 171.86134438]),
        np.array([-64.68869199, 168.84120278]), np.array([-74.43093289, 166.63116555]),
        np.array([-84.29924191, 165.07389931]), np.array([-94.23974026, 164.07363991]),
        np.array([-104.21857632, 163.57911782]), np.array([-108.74450864, 162.4433146]),
        np.array([-99.72102536, 158.15805154]), np.array([-91.07119168, 153.16133217]),
        np.array([-82.85076321, 147.48593239]), np.array([-75.11185635, 141.16970925]),
        np.array([-67.90448178, 134.25317483]), np.array([-61.27606381, 126.77986245]),
        np.array([-55.27091397, 118.79719643]), np.array([-49.9307803, 110.35516457]),
        np.array([-45.29386319, 101.50746255]), np.array([-41.39328183, 92.31131081]),
        np.array([-38.25712003, 82.82717995]), np.array([-35.90661801, 73.11824135]),
        np.array([-34.35408963, 63.25064187]), np.array([-33.60349454, 53.28952126]),
        np.array([-33.64879025, 43.30029397]), np.array([-34.4908923, 33.34654336]),
        np.array([-36.13350858, 23.49318032]), np.array([-38.57146634, 13.80605416]),
        np.array([-41.79082669, 4.34986977]), np.array([-45.76993741, -4.81252189]),
        np.array([-50.47979916, -13.62168022]), np.array([-55.88804807, -22.02049918]),
        np.array([-61.95563687, -29.95546623]), np.array([-68.64219083, -37.37691398]),
        np.array([-75.90362729, -44.23668571]), np.array([-83.69268216, -50.49090476]),
        np.array([-91.95968808, -56.09855552]), np.array([-100.65197934, -61.02045341]),
        np.array([-109.71428098, -65.22288413]), np.array([-119.08754147, -68.67632194]),
        np.array([-128.71030606, -71.35732932]), np.array([-138.51887692, -73.24954124]),
        np.array([-147.07144727, -74.3459539]), np.array([-137.08621396, -74.63752647]),
        np.array([-127.10908307, -74.14961906]), np.array([-117.20304288, -72.86220451]),
        np.array([-107.43365659, -70.77690788]), np.array([-97.86660184, -67.90441795]),
        np.array([-88.56461514, -64.26293083]), np.array([-79.58899106, -59.87865348]),
        np.array([-70.99749936, -54.78246208]), np.array([-62.8446597, -49.01015373]),
        np.array([-55.18224515, -42.60141654]), np.array([-48.05864133, -35.59857078]),
        np.array([-41.51957883, -28.0470037]), np.array([-35.60808743, -19.99452873]),
        np.array([-30.36424435, -11.49230094]), np.array([-25.82471646, -2.5942678]),
        np.array([-22.02154721, 6.6426249]), np.array([-18.98158444, 16.15806679]),
        np.array([-16.7250842, 25.88909249]), np.array([-15.26452054, 35.77101998]),
        np.array([-14.60323514, 45.73829751]), np.array([-14.71943845, 55.7275248]),
        np.array([-15.57589139, 65.680131]), np.array([-17.20685757, 75.53532509]),
        np.array([-19.64181699, 85.22329812]), np.array([-22.89853085, 94.66613869]),
        np.array([-26.97876157, 103.78332619]), np.array([-31.86733426, 112.49360757]),
        np.array([-37.53117551, 120.72117715]), np.array([-43.92116727, 128.39833169]),
        np.array([-50.97587765, 135.46959023]), np.array([-58.6239642, 141.89489846]),
        np.array([-66.79044522, 147.64747719]), np.array([-75.39896573, 152.71478371]),
        np.array([-84.3765582, 157.0962687]), np.array([-83.92758359, 159.04496865]),
        np.array([-73.9493884, 159.54278664]), np.array([-64.02072324, 160.65011697]),
        np.array([-54.18828, 162.4167643]), np.array([-44.52280606, 164.93817238]),
        np.array([-35.14311398, 168.36787514]), np.array([-26.26410092, 172.93237405]),
        np.array([-18.29182614, 178.9282084]), np.array([-11.9451846, 186.60568337]),
        np.array([-6.36545743, 192.45269875]), np.array([3.01531039, 189.01535134]),
        np.array([12.20521365, 185.0957499]), np.array([21.17850314, 180.70236306]),
        np.array([29.90981876, 175.84668069]), np.array([38.3743497, 170.53927712]),
        np.array([46.54579745, 164.79118447]), np.array([54.39864169, 158.6146708]),
        np.array([61.90582858, 152.02227883]), np.array([69.03927432, 145.02755837]),
        np.array([75.76904117, 141.32713418]), np.array([82.33712589, 148.85688882]),
        np.array([88.90534793, 156.38682656]), np.array([95.47356998, 163.9167643]),
        np.array([102.04170047, 171.44656472]), np.array([108.60992252, 178.97650246]),
        np.array([115.17800723, 186.50630288]), np.array([121.74622928, 194.03619485]),
        np.array([128.31445132, 201.56613259]), np.array([137.93206607, 202.38923745]),
        np.array([147.9241315, 202.38923745]), np.array([157.91601382, 202.38923745]),
        np.array([167.90807925, 202.38923745]), np.array([177.90014468, 202.38923745]),
        np.array([187.89202701, 202.38923745]), np.array([197.88409244, 202.38923745]),
        np.array([201.47382938, 195.28291421]), np.array([199.87527286, 185.47715859]),
        np.array([194.47471439, 177.16417031]), np.array([186.30171024, 171.49385171]),
        np.array([176.91242801, 168.12809853]), np.array([167.08296024, 166.37765603]),
        np.array([157.11227237, 165.80023293]), np.array([149.17922794, 163.58575539]),
        np.array([147.35888492, 153.76109414]), np.array([145.53849612, 143.93624978]),
        np.array([143.71815311, 134.11158852]), np.array([149.94918643, 127.56318764]),
        np.array([157.56820499, 121.10514931]), np.array([164.47782718, 113.89390664]),
        np.array([170.56937991, 105.97981362]), np.array([175.76151859, 97.44874673]),
        np.array([180.00700198, 88.40860085]), np.array([183.29667484, 78.97825722]),
        np.array([185.65278445, 69.2718821]), np.array([187.11561404, 59.39082436]),
        np.array([187.73071109, 49.42082314]), np.array([187.53245364, 39.43344979]),
        np.array([186.51415836, 29.49652199]), np.array([189.75695621, 23.77658181]),
        np.array([199.70077335, 22.83734231]), np.array([209.50854312, 20.94735055]),
        np.array([219.09951602, 18.15755562]), np.array([228.39156924, 14.49356942]),
        np.array([237.28715335, 9.95175271]), np.array([245.64678775, 4.48957925]),
        np.array([253.24346744, -1.98853202]), np.array([259.65211307, -9.63341422]),
        np.array([264.00649844, -18.58459373]), np.array([264.73878299, -28.46322532]),
        np.array([188.25846683, -42.35559745]), np.array([181.20075809, -49.00175376]),
        np.array([181.53721439, -58.69073387]), np.array([189.03872501, -64.83058067]),
        np.array([198.60030948, -63.23486228]), np.array([203.70684634, -54.99648948]),
        np.array([200.88642703, -45.72286125])]

bg = pygame.surface.Surface((1080, 720))
bg.fill(0)
bg.set_alpha(150)


def mult(x, y):
    return np.array([x[0] * y[0] - x[1] * y[1], x[0] * y[1] + x[1] * y[0]])



def dft(data):
    X = []
    N = len(data)
    for k in range(N):
        s = np.array([0.0, 0.0])
        for n in range(N):
            theta = np.pi * 2 * k * n / N
            s += mult(np.array([np.cos(theta), -np.sin(theta)]), data[n])
        s /= N
        X.append((k, np.sqrt(sum(s * s)), math.atan2(s[1], s[0])))

    return X


def draw(X, time):
    start = np.array([540.0, 360.0])
    for i in X:
        freq, amp, phase = i
        theta = (time * freq) + phase
        v = np.array([np.cos(theta), np.sin(theta)])
        pygame.draw.circle(window, (255, 255, 255), start, amp, 1)
        pygame.draw.line(window, (255, 255, 255), start, start + v*amp)
        start += v * amp
    path.append(start)

    window.blit(bg, (0, 0))

    if len(path) > 1:
        for j in range(1, len(path)):
            pygame.draw.line(window, (255, 255, 255), path[j - 1], path[j])


a = dft(data)
a = sorted(a, key=lambda x: x[1], reverse=True)

run = True
while run:
    for e in pygame.event.get():
        if e.type == pygame.QUIT:
            run = False
            break

    clock.tick(fps)
    dt = clock.get_time() / 1000
    time += np.pi * 2 / len(data)

    if time > np.pi * 2:
        time = 0
        path.remove(path[0])

    window.fill(0)

    draw(a, time)

    pygame.display.update()

pygame.quit()
